<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>chromadb向量数据库 | Yinjin Yao的博客</title><meta name="author" content="Yinjin Yao"><meta name="copyright" content="Yinjin Yao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="chromadb官方地址:https:&#x2F;&#x2F;docs.trychroma.com&#x2F;docs&#x2F;overview&#x2F;introduction  本文大部分内容地址  GitHub 仓库: https:&#x2F;&#x2F;github.com&#x2F;chroma-core&#x2F;chroma 查看 Issues和Discussions。   基本介绍什么是矢量存储？向量存储是专门为有效地存储和检索向量嵌入而设计的数据库。之所以需要它">
<meta property="og:type" content="article">
<meta property="og:title" content="chromadb向量数据库">
<meta property="og:url" content="https://cryingatnight.github.io/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="Yinjin Yao的博客">
<meta property="og:description" content="chromadb官方地址:https:&#x2F;&#x2F;docs.trychroma.com&#x2F;docs&#x2F;overview&#x2F;introduction  本文大部分内容地址  GitHub 仓库: https:&#x2F;&#x2F;github.com&#x2F;chroma-core&#x2F;chroma 查看 Issues和Discussions。   基本介绍什么是矢量存储？向量存储是专门为有效地存储和检索向量嵌入而设计的数据库。之所以需要它">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cryingatnight.github.io/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg">
<meta property="article:published_time" content="2025-09-23T04:00:00.000Z">
<meta property="article:modified_time" content="2025-09-23T16:37:51.853Z">
<meta property="article:author" content="Yinjin Yao">
<meta property="article:tag" content="chroma">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cryingatnight.github.io/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "chromadb向量数据库",
  "url": "https://cryingatnight.github.io/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/",
  "image": "https://cryingatnight.github.io/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg",
  "datePublished": "2025-09-23T04:00:00.000Z",
  "dateModified": "2025-09-23T16:37:51.853Z",
  "author": [
    {
      "@type": "Person",
      "name": "Yinjin Yao",
      "url": "https://cryingatnight.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/headimage.png"><link rel="canonical" href="https://cryingatnight.github.io/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'chromadb向量数据库',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/headimage.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-flask"></i><span> 实验室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="http://121.199.61.105/"><i class="fa-fw fas fa-q"></i><span> 豆瓣网开发</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://fuckornot.on.websim.com/"><i class="fa-fw fa fa-trophy"></i><span> 上不上AI评分系统</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://fontawesome.com/icons"><i class="fa-fw fa fa-check-circle"></i><span> font-awesome v6 图标</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/headimage.png" alt="Logo"><span class="site-name">Yinjin Yao的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">chromadb向量数据库</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-flask"></i><span> 实验室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="http://121.199.61.105/"><i class="fa-fw fas fa-q"></i><span> 豆瓣网开发</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://fuckornot.on.websim.com/"><i class="fa-fw fa fa-trophy"></i><span> 上不上AI评分系统</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://fontawesome.com/icons"><i class="fa-fw fa fa-check-circle"></i><span> font-awesome v6 图标</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">chromadb向量数据库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-23T04:00:00.000Z" title="发表于 2025-09-23 12:00:00">2025-09-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-23T16:37:51.853Z" title="更新于 2025-09-24 00:37:51">2025-09-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.trychroma.com/docs/overview/introduction"><strong>chromadb</strong>官方地址:https://docs.trychroma.com/docs/overview/introduction</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2201_75509689/article/details/148783957?ops_request_misc=&request_id=&biz_id=102&utm_term=chromadb&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-148783957.142%5Ev102%5Epc_search_result_base5&spm=1018.2226.3001.4187">本文大部分内容地址</a></p>
</li>
<li><p><strong>GitHub 仓库:</strong> <a target="_blank" rel="noopener" href="https://github.com/chroma-core/chroma" title="https://github.com/chroma-core/chroma">https://github.com/chroma-core/chroma</a> 查看 Issues和Discussions。</p>
</li>
</ul>
<h1 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h1><h2 id="什么是矢量存储？"><a href="#什么是矢量存储？" class="headerlink" title="什么是矢量存储？"></a>什么是矢量存储？</h2><p>向量存储是专门为有效地存储和检索向量嵌入而设计的数据库。之所以需要它们，是因为像 SQL 这样的传统数据库<strong>没有针对存储和查询大型向量数据进行优化</strong>。</p>
<p>嵌入在高维空间中以数字向量格式表示数据（通常是非结构化数据，如文本）。传统的关系数据库不太适合存储和搜索这些向量表示。</p>
<p>向量存储可以<strong>使用相似性算法对相似的向量进行索引和快速搜索</strong>。它允许应用程序在给定目标向量查询的情况下查找相关向量。</p>
<p>在个性化聊天机器人的情况下，用户输入生成式 AI 模型的提示。然后，该模型使用相似性搜索算法在文档集合中搜索相似文本。然后，由此产生的信息用于生成高度个性化和准确的响应。这是通过在向量存储中嵌入和向量索引来实现的。</p>
<h2 id="什么是ChromaDB？"><a href="#什么是ChromaDB？" class="headerlink" title="什么是ChromaDB？"></a>什么是ChromaDB？</h2><p>ChromaDB是一个开源矢量存储，用于存储和检索矢量嵌入。它的主要用途是保存嵌入和元数据，以便以后由大型语言模型使用。此外，它还可用于文本数据的语义搜索引擎。</p>
<p>Chroma DB主要特点：</p>
<ul>
<li>支持不同的底层存储选项，例如用于独立的 DuckDB 或用于可扩展性的 ClickHouse。</li>
<li>提供 Python 和 JavaScript&#x2F;TypeScript 的 SDK。</li>
<li>专注于简单性、速度和支持性分析。</li>
</ul>
<p><img src="/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/file-20250918154240773.png"></p>
<h2 id="ChromaDB是如何工作的？"><a href="#ChromaDB是如何工作的？" class="headerlink" title="ChromaDB是如何工作的？"></a>ChromaDB是如何工作的？</h2><ol>
<li>首先，必须创建一个类似于关系数据库中的表的集合。默认情况下，Chroma 使用 将文本转换为嵌入，但您可以修改集合以使用其他嵌入模型。all-MiniLM-L6-v2</li>
<li>将具有元数据和唯一 ID 的文本文档添加到新创建的集合中。当您的收藏收到文本时，它会自动将其转换为嵌入。</li>
<li>通过文本或嵌入查询集合以接收相似的文档。您还可以根据元数据筛选出结果。</li>
</ol>
<p>在下一部分中，我们将使用 Chroma 和 OpenAI API 来创建我们自己的矢量数据库。</p>
<h2 id="ChromaDB-的核心概念"><a href="#ChromaDB-的核心概念" class="headerlink" title="ChromaDB 的核心概念"></a>ChromaDB 的核心概念</h2><ul>
<li><p><strong>客户端（Client）</strong>： 这是你与 ChromaDB 交互的接口。ChromaDB 支持多种部署模式，你可以用本地模式（数据存在本地文件）、客户端-服务器模式（连接远程服务器）或持久化模式（数据存到指定路径）。</p>
</li>
<li><p><strong>集合（Collection）</strong>： 集合是存储向量、文档和元数据的逻辑单元。你可以把它想象成关系数据库中的一个“表”，或者一个特定主题的文档库。你的所有相关数据都会放到一个集合里。</p>
</li>
<li><p><strong>文档（Document）</strong>： 这是你的原始数据，通常是文本。当你把文档添加到集合时，ChromaDB 会自动（或使用你指定的模型）将其转换为向量。</p>
</li>
<li><p><strong>嵌入（Embedding）</strong>： 文档的数字表示。这是语义搜索的基础。</p>
</li>
<li><p><strong>元数据（Metadata）</strong>： 附加到文档或向量上的描述性信息。比如，你存储了一篇文章的向量，它的元数据可以是文章的标题、作者、发布日期等。元数据对于过滤和查询结果非常有用。</p>
</li>
<li><p><strong>ID</strong>： 每个文档和其对应的向量都必须有一个唯一的 ID。（字符串或 UUID）</p>
</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="安装Chromadb"><a href="#安装Chromadb" class="headerlink" title="安装Chromadb"></a>安装Chromadb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install chromadb</span><br></pre></td></tr></table></figure>

<h2 id="初始化Chroma客户端"><a href="#初始化Chroma客户端" class="headerlink" title="初始化Chroma客户端"></a>初始化Chroma客户端</h2><p>内存模式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> chromadb</span><br><span class="line">client = chromadb.Client()  <span class="comment"># 使用默认的持久化目录，但默认是内存模式</span></span><br><span class="line"><span class="comment"># 或者显式指定</span></span><br><span class="line">client = chromadb.PersistentClient(path=<span class="string">&quot;/path/to/db&quot;</span>)  <span class="comment"># 指定持久化目录，但第一次使用前该目录通常不存在</span></span><br></pre></td></tr></table></figure>
<p>http客户端：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = chromadb.HttpClient(host=<span class="string">&quot;localhost&quot;</span>, port=<span class="string">&quot;8000&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="创建-获取集合-Collection"><a href="#创建-获取集合-Collection" class="headerlink" title="创建&#x2F;获取集合 (Collection)"></a>创建&#x2F;获取集合 (Collection)</h2><p>集合(collection)是在chroma数据库的作用类似Mysql的表，存储向量数据（包括文档和其他源数据）的地方，下面创建一个集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">collection = client.create_collection(</span><br><span class="line">    name=<span class="string">&quot;my_knowledge_base&quot;</span>,  <span class="comment"># 集合名称</span></span><br><span class="line">    embedding_function=embedding_fn,  <span class="comment"># 可选：指定自定义嵌入函数</span></span><br><span class="line">    metadata=&#123;<span class="string">&quot;hnsw:space&quot;</span>: <span class="string">&quot;cosine&quot;</span>&#125;  <span class="comment"># 可选：配置索引参数</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>embedding_function: 强烈建议提供！如果不提供，在添加数据时必须传入预计算好的向量 (embeddings 参数)。提供函数可以让 ChromaDB 自动为你添加的文本生成向量。</p>
</li>
<li><p>metadata: 可以配置集合的索引参数。例如 {“hnsw:space”: “cosine”} (余弦相似度) 或 {“hnsw:space”: “l2”} (欧氏距离)。默认通常是 “12”。</p>
</li>
</ul>
<p><strong>获取现有集合：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collection = client.get_collection(</span><br><span class="line">    name=<span class="string">&quot;my_knowledge_base&quot;</span>,  <span class="comment"># 集合名称</span></span><br><span class="line">    embedding_function=embedding_fn  <span class="comment"># 如果创建时指定了，这里通常也需要指定相同的函数用于查询</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="向集合添加数据-Add-Upsert"><a href="#向集合添加数据-Add-Upsert" class="headerlink" title="向集合添加数据 (Add&#x2F; Upsert)"></a>向集合添加数据 (Add&#x2F; Upsert)</h2><p><strong>方式一：让 ChromaDB 自动生成向量 (推荐，需提供 <code>embedding_function</code>)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 定义或获取一个嵌入函数 (这里以 sentence-transformers 为例)</span></span><br><span class="line"><span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer</span><br><span class="line">model = SentenceTransformer(<span class="string">&#x27;all-MiniLM-L6-v2&#x27;</span>)  <span class="comment"># 小型高效模型</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">embedding_fn</span>(<span class="params">texts: <span class="built_in">list</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">list</span>[<span class="built_in">list</span>[<span class="built_in">float</span>]]:</span><br><span class="line">    <span class="comment"># ChromaDB 期望嵌入函数接收字符串列表，返回向量列表</span></span><br><span class="line">    <span class="keyword">return</span> model.encode(texts).tolist()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 创建集合时指定该函数，或者在 get_collection 时指定</span></span><br><span class="line">collection = client.get_collection(name=<span class="string">&quot;my_knowledge_base&quot;</span>, embedding_function=embedding_fn)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 添加数据</span></span><br><span class="line">collection.add(</span><br><span class="line">    documents=[  <span class="comment"># 原始文本 (强烈建议提供)</span></span><br><span class="line">        <span class="string">&quot;The cat sat on the mat.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Dogs are great companions.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;The sun rises in the east.&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    metadatas=[  <span class="comment"># 对应的元数据字典列表 (可选但推荐)</span></span><br><span class="line">        &#123;<span class="string">&quot;source&quot;</span>: <span class="string">&quot;sentence1&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;example&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;source&quot;</span>: <span class="string">&quot;sentence2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;example&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;source&quot;</span>: <span class="string">&quot;sentence3&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;fact&quot;</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    ids=[<span class="string">&quot;id1&quot;</span>, <span class="string">&quot;id2&quot;</span>, <span class="string">&quot;id3&quot;</span>]  <span class="comment"># 唯一 ID</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p> <strong>方式二：自己提供预计算好的向量 (如果不提供 <code>embedding_function</code> 或需要精细控制)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设你已经计算好向量了</span></span><br><span class="line">precomputed_embeddings = [</span><br><span class="line">    [<span class="number">0.1</span>, <span class="number">0.2</span>, ..., <span class="number">0.5</span>],  <span class="comment"># id1 的向量</span></span><br><span class="line">    [<span class="number">0.6</span>, -<span class="number">0.3</span>, ..., <span class="number">0.8</span>],  <span class="comment"># id2 的向量</span></span><br><span class="line">    [-<span class="number">0.2</span>, <span class="number">0.4</span>, ..., <span class="number">0.1</span>]   <span class="comment"># id3 的向量</span></span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line">collection.add(</span><br><span class="line">    embeddings=precomputed_embeddings,  <span class="comment"># 必须提供</span></span><br><span class="line">    documents=[...],  <span class="comment"># 可选</span></span><br><span class="line">    metadatas=[...],  <span class="comment"># 可选</span></span><br><span class="line">    ids=[<span class="string">&quot;id1&quot;</span>, <span class="string">&quot;id2&quot;</span>, <span class="string">&quot;id3&quot;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong><code>upsert</code> 方法:</strong> 如果 <code>id</code> 已存在，则更新该条目；如果不存在，则添加新条目。参数与 <code>add</code> 相同。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.upsert(...)  <span class="comment"># 参数同 add</span></span><br></pre></td></tr></table></figure>

<h2 id="查询集合-Query"><a href="#查询集合-Query" class="headerlink" title="查询集合 (Query)"></a>查询集合 (Query)</h2><p>这是另一个核心步骤。根据查询文本或向量，找到集合中最相似的条目。</p>
<p><strong>使用查询文本 (ChromaDB 自动用 <code>embedding_function</code> 转为向量):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">results = collection.query(</span><br><span class="line">    query_texts=[<span class="string">&quot;Where does the sun rise?&quot;</span>],  <span class="comment"># 查询文本列表</span></span><br><span class="line">    n_results=<span class="number">2</span>,  <span class="comment"># 返回最相似的 2 个结果</span></span><br><span class="line">    <span class="comment"># where=&#123;&quot;metadata_field&quot;: &#123;&quot;$eq&quot;: &quot;value&quot;&#125;&#125;,  # 可选：基于元数据的过滤</span></span><br><span class="line">    <span class="comment"># where_document=&#123;&quot;$contains&quot;: &quot;keyword&quot;&#125;      # 可选：基于文档内容的过滤</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>使用查询向量 (自己提供):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query_vector = embedding_fn([<span class="string">&quot;Where does the sun rise?&quot;</span>])[<span class="number">0</span>]  <span class="comment"># 假设 embedding_fn 可用</span></span><br><span class="line">results = collection.query(</span><br><span class="line">    query_embeddings=[query_vector],  <span class="comment"># 查询向量列表</span></span><br><span class="line">    n_results=<span class="number">2</span></span><br><span class="line">    <span class="comment"># ... 同样可以加 where 和 where_document 过滤</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>理解返回结果 (results): results 是一个字典，包含：</p>
<ul>
<li><p>ids: 最相似条目的 ID 列表 (列表的列表，外层列表对应每个查询文本&#x2F;向量)。</p>
</li>
<li><p>distances: 对应的距离 (越小越相似)。</p>
</li>
<li><p>metadatas: 对应的元数据。</p>
</li>
<li><p>documents: 对应的原始文档文本。</p>
</li>
<li><p>embeddings (如果 include&#x3D;[‘embeddings’]): 对应的向量。</p>
</li>
<li><p>uris &#x2F; data (通常不常用)。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(results[<span class="string">&quot;ids&quot;</span>])      <span class="comment"># 输出: [[&#x27;id3&#x27;, &#x27;id1&#x27;]]  (对于单个查询)</span></span><br><span class="line"><span class="built_in">print</span>(results[<span class="string">&quot;documents&quot;</span>]) <span class="comment"># 输出: [[&#x27;The sun rises in the east.&#x27;, &#x27;The cat sat on the mat.&#x27;]]</span></span><br><span class="line"><span class="built_in">print</span>(results[<span class="string">&quot;distances&quot;</span>]) <span class="comment"># 输出: [[0.15, 0.87]]   (假设 id3 距离更小)</span></span><br></pre></td></tr></table></figure>

<h2 id="管理数据"><a href="#管理数据" class="headerlink" title="管理数据"></a>管理数据</h2><p><strong>获取 (Get):</strong> 根据 ID 获取条目。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">items = collection.get(</span><br><span class="line">    ids=[<span class="string">&quot;id1&quot;</span>, <span class="string">&quot;id2&quot;</span>],  <span class="comment"># 可选：指定 ID</span></span><br><span class="line">    <span class="comment"># where=&#123;...&#125;,        # 可选：元数据过滤</span></span><br><span class="line">    <span class="comment"># where_document=&#123;...&#125;, # 可选：文档内容过滤</span></span><br><span class="line">    <span class="comment"># limit=10,           # 可选：限制返回数量</span></span><br><span class="line">    <span class="comment"># offset=0,           # 可选：偏移量</span></span><br><span class="line">    <span class="comment"># include=[&quot;metadatas&quot;, &quot;documents&quot;, &quot;embeddings&quot;]  # 指定返回哪些字段</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># items 结构与 query 返回的单个查询结果类似 (ids, metadatas, documents, embeddings 都是列表)</span></span><br></pre></td></tr></table></figure>

<p><strong>更新 (Update):</strong> 更新指定 ID 的条目。需要提供要更新的字段 (<code>embeddings</code>, <code>metadatas</code>, <code>documents</code>)。未提供的字段保持不变。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">collection.update(</span><br><span class="line">    ids=[<span class="string">&quot;id2&quot;</span>],</span><br><span class="line">    metadatas=[&#123;<span class="string">&quot;source&quot;</span>: <span class="string">&quot;updated_sentence2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;example&quot;</span>&#125;],</span><br><span class="line">    documents=[<span class="string">&quot;Dogs are truly amazing companions.&quot;</span>]</span><br><span class="line">    <span class="comment"># 也可以更新 embeddings=[new_vector]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>删除 (Delete):</strong> 删除指定 ID 或满足条件的条目。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按 ID 删除</span></span><br><span class="line">collection.delete(ids=[<span class="string">&quot;id1&quot;</span>])</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 按元数据条件删除</span></span><br><span class="line">collection.delete(where=&#123;<span class="string">&quot;type&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: <span class="string">&quot;example&quot;</span>&#125;&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 按文档内容条件删除 (谨慎使用!)</span></span><br><span class="line">collection.delete(where_document=&#123;<span class="string">&quot;$contains&quot;</span>: <span class="string">&quot;cat&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="持久化存储-重要！"><a href="#持久化存储-重要！" class="headerlink" title="持久化存储 (重要！)"></a>持久化存储 (重要！)</h2><p>默认的 <code>chromadb.Client()</code> 是纯内存的。重启 Python 程序数据就没了！必须配置持久化。</p>
<p><strong>使用 <code>PersistentClient</code>:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client = chromadb.PersistentClient(path=<span class="string">&quot;/path/to/db&quot;</span>)  <span class="comment"># 指定一个目录存放数据库文件</span></span><br><span class="line"><span class="comment"># 然后在这个 client 上创建的集合会自动持久化到该目录</span></span><br></pre></td></tr></table></figure>

<p>下次启动时，使用<strong>相同的</strong> <code>path</code> 创建 <code>PersistentClient</code>，然后 <code>get_collection</code> 就能恢复之前的数据。</p>
<h2 id="关键注意事项"><a href="#关键注意事项" class="headerlink" title="关键注意事项"></a>关键注意事项</h2><ol>
<li><p>务必指定 embedding_function: 除非你有特殊原因需要自己管理向量，否则在创建&#x2F;获取集合时指定嵌入函数是最高效和不易出错的方式。</p>
</li>
<li><p>务必持久化 (PersistentClient): 除非你明确只需要临时内存数据，否则一定要用 PersistentClient 并指定存储路径，否则辛苦添加的数据会丢失。</p>
</li>
<li><p>提供 documents: 强烈建议在 add 时提供原始文档 (documents)。这样在 query 时，ChromaDB 可以直接返回最相似的文本内容，无需你再根据 ID 去外部查找，非常方便。</p>
</li>
<li><p>善用 metadatas: 元数据是强大的过滤工具。提前规划好你需要哪些元数据字段（如 source, author, date, category），并在添加数据时填充。查询时用 where 参数进行过滤可以显著缩小搜索范围，提高速度和精度。</p>
</li>
<li><p>理解距离 (Distance): query 返回的 distances 值取决于集合创建时配置的 hnsw:space。”l2” 是欧氏距离 (越小越好)，”cosine” 是余弦相似度距离 (0 表示完全同向，1 表示正交，2 表示完全反向，通常也是越小表示越相似)。注意看文档确认你使用的空间和距离含义。</p>
</li>
<li><p>嵌入模型的选择至关重要: ChromaDB 只是存储和检索向量。向量的质量完全取决于你使用的嵌入模型。对于文本，像 all-MiniLM-L6-v2 (本地), text-embedding-3-small (OpenAI API) 都是不错的起点。选择适合你任务和数据量的模型。</p>
</li>
<li><p>upsert 是更新数据的好方法: 比先 delete 再 add 更简洁高效。</p>
</li>
<li><p>过滤语法: where 和 where_document 使用类似 MongoDB 的查询语法。查看 ChromaDB 文档学习具体操作符 ($eq, $ne, $gt, $gte, $lt, $lte, $in, $nin, $contains 等)。</p>
</li>
<li><p>性能考量:</p>
<ol>
<li><p>数据量很大时，查询速度会变慢。确保 n_results 设置合理。</p>
</li>
<li><p>ChromaDB 在添加数据时会自动构建索引（默认是 HNSW）。大量数据添加后，索引构建可能需要时间。</p>
</li>
<li><p>对于生产级超大向量数据集，可能需要考虑更专业的向量数据库（如 Milvus, Pinecone, Weaviate 等），但 ChromaDB 对于中小规模应用和原型开发非常出色。</p>
</li>
</ol>
</li>
</ol>
<h1 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h1><h2 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chroma-llm-demo/</span><br><span class="line">├── main.py</span><br><span class="line">├── .env</span><br><span class="line">├── requirements.txt</span><br><span class="line">└── docs/</span><br><span class="line">    ├── biology.txt</span><br><span class="line">    ├── computer.txt</span><br><span class="line">    └── history.txt</span><br></pre></td></tr></table></figure>
<h2 id="biology-txt"><a href="#biology-txt" class="headerlink" title="biology.txt"></a>biology.txt</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">一、生物的基本特征  </span><br><span class="line">所有生物都具备 4 个核心特征，是区分生物与非生物的关键：  </span><br><span class="line">新陈代谢：生物与环境持续交换物质和能量的过程，分为 “同化作用”（如植物通过光合作用合成有机物）和 “异化作用”（如动物通过呼吸分解有机物释放能量），一旦停止，生命即终止。  </span><br><span class="line">繁殖能力：生物能产生后代延续物种，分无性繁殖（如细菌分裂、酵母菌出芽，后代遗传物质与亲代一致）和有性繁殖（如人类、开花植物，后代结合父母双方遗传物质，具有多样性）。  </span><br><span class="line">应激性：生物能对外界刺激作出反应，如含羞草受触碰闭合叶片（物理刺激）、植物向光生长（向光性，对光照刺激的适应）。  </span><br><span class="line">遗传与变异：遗传保证物种稳定性（如狗生狗、猫生猫），变异推动物种进化（如长颈鹿祖先因脖子长度差异，长脖子个体更易获取高处树叶，逐渐演化成现物种）。  </span><br><span class="line">二、生物的核心分类  </span><br><span class="line">根据细胞结构，生物可分为两大类，这是生物学分类的基础框架：  </span><br><span class="line">原核生物：无成形细胞核（遗传物质裸露在细胞质中），结构简单，如细菌（大肠杆菌、乳酸菌）、蓝藻（能进行光合作用的单细胞生物，是最早产生氧气的生物之一）。  </span><br><span class="line">真核生物：有成形细胞核（遗传物质被核膜包裹），结构更复杂，包含所有多细胞生物及部分单细胞生物，如动物（人类、昆虫）、植物（树木、花草）、真菌（蘑菇、酵母菌）。  </span><br><span class="line">三、生态系统的基本组成  </span><br><span class="line">生态系统是生物与环境的统一整体，核心成分包括 3 类：  </span><br><span class="line">生产者：主要是绿色植物，通过光合作用将太阳能转化为化学能，为整个生态系统提供能量基础。  </span><br><span class="line">消费者：依赖生产者获取能量，如草食动物（兔子）、肉食动物（狐狸）。  </span><br><span class="line">分解者：主要是细菌、真菌，将动植物遗体分解为无机物（如二氧化碳、无机盐），回归环境供生产者再利用，完成物质循环。</span><br></pre></td></tr></table></figure>
<h2 id="computer-txt"><a href="#computer-txt" class="headerlink" title="computer.txt"></a>computer.txt</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">一、计算机基础构成  </span><br><span class="line">计算机核心由 “硬件 + 软件” 组成，二者协同实现功能：  </span><br><span class="line">硬件系统：物理设备，核心部件包括：  </span><br><span class="line">CPU（中央处理器）：相当于 “大脑”，负责运算与指令控制；  </span><br><span class="line">内存（RAM）：临时存储数据，断电后数据丢失，影响运行速度；  </span><br><span class="line">存储设备（硬盘 / SSD）：长期保存数据，如文档、软件等。  </span><br><span class="line">软件系统：驱动硬件的程序，分两类：  </span><br><span class="line">系统软件（如 Windows、macOS）：管理硬件，为其他软件提供运行环境；  </span><br><span class="line">应用软件（如 Office、微信）：满足特定需求，如办公、通讯。  </span><br><span class="line">二、关键发展节点  </span><br><span class="line">计算机发展历经四次 “革命”，推动技术飞跃：  </span><br><span class="line">1946 年：首台电子计算机 ENIAC：诞生于美国，用电子管组成，体积庞大（占地 167 平方米），标志计算机时代开启；  </span><br><span class="line">1950 年代：晶体管替代电子管：计算机体积缩小、功耗降低，进入 “第二代计算机”；  </span><br><span class="line">1969 年：互联网雏形 ARPANET：美国军方研发，后演变为全球互联网，打破信息传播边界；  </span><br><span class="line">2007 年：智能手机普及：整合计算机功能（如运算、联网），推动 “移动计算” 时代到来。  </span><br><span class="line">三、核心应用领域  </span><br><span class="line">计算机已渗透多场景，改变生产生活：  </span><br><span class="line">办公自动化：通过 Office、钉钉等软件，实现文档处理、远程协作，提升工作效率；  </span><br><span class="line">人工智能（AI）：依托计算机算力，实现图像识别（如人脸识别）、语音助手（如 Siri）、自动驾驶等智能功能；  </span><br><span class="line">工业互联网：计算机与工业设备结合，实现生产线自动化控制、设备故障预警，推动 “智能制造” 升级。</span><br></pre></td></tr></table></figure>

<h2 id="history-txt"><a href="#history-txt" class="headerlink" title="history.txt"></a>history.txt</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">一、人类早期文明摇篮（公元前 3500 年 - 公元前 500 年）  </span><br><span class="line">四大文明古国奠定人类文明基石，均发源于大河流域：  </span><br><span class="line">古埃及（尼罗河）：发明象形文字，建造金字塔（法老陵墓，体现天文与工程智慧），创立太阳历（按尼罗河泛滥周期制定，为公历雏形）。  </span><br><span class="line">古巴比伦（两河流域）：颁布《汉谟拉比法典》（迄今已知世界最早成文法典，强调 “以眼还眼” 的司法原则），发明楔形文字。  </span><br><span class="line">古印度（印度河 - 恒河）：创立种姓制度（分婆罗门、刹帝利等四级，影响社会结构千年），诞生佛教（释迦牟尼创立，主张 “众生平等”）。  </span><br><span class="line">中国（黄河 - 长江）：夏商周三代确立分封制与宗法制，青铜文明鼎盛（如司母戊鼎），甲骨文成为最早成熟文字。  </span><br><span class="line">二、中古时期的文明交融（公元 5 世纪 - 15 世纪）  </span><br><span class="line">东西方文明通过交流互鉴发展：  </span><br><span class="line">东方：中国唐朝国力强盛，长安成为国际都会，玄奘西行取经（促进佛教中国化），鉴真东渡日本（传播唐文化，推动日本大化改新）；阿拉伯帝国崛起，成为东西方桥梁（翻译希腊典籍、传播中国造纸术与印度数字）。  </span><br><span class="line">西方：欧洲处于中世纪，基督教主导社会，庄园经济为基础；12 世纪后城市兴起（如威尼斯、佛罗伦萨），为日后文艺复兴埋下伏笔。  </span><br><span class="line">三、近代历史的转折节点（15 世纪 - 20 世纪初）  </span><br><span class="line">关键事件推动世界格局巨变：  </span><br><span class="line">新航路开辟（15 世纪末）：哥伦布发现美洲、达・伽马抵达印度，打破世界孤立状态，开启全球殖民时代。  </span><br><span class="line">工业革命（18 世纪 60 年代起）：英国率先以蒸汽机为核心，从手工生产转向机器生产，推动生产力飞跃，催生工业资产阶级与无产阶级。  </span><br><span class="line">辛亥革命（1911 年）：中国近代史上首次完全意义上的资产阶级革命，推翻清朝统治，结束两千多年君主专制，传播民主共和理念。</span><br></pre></td></tr></table></figure>

<h2 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chromadb  </span><br><span class="line">openai</span><br></pre></td></tr></table></figure>
<h2 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 下面的api_key去硅基流动官网申请</span><br><span class="line">SILICONFLOW_API_KEY=&#x27;sk-XXXXXXpdeijbbauaaawhgjexgwxarqpymzgocwvtXXXXXXXXX&#x27;  </span><br><span class="line">BASE_URL=&#x27;https://api.siliconflow.cn/v1&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="main-py文件"><a href="#main-py文件" class="headerlink" title="main.py文件"></a>main.py文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> json  </span><br><span class="line"><span class="keyword">import</span> chromadb  </span><br><span class="line"><span class="keyword">from</span> chromadb <span class="keyword">import</span> PersistentClient  </span><br><span class="line">  </span><br><span class="line">PERSIST_DIR = <span class="string">&quot;chroma_db&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 初始化持久化客户端  </span></span><br><span class="line">client = PersistentClient(path=PERSIST_DIR)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 获取集合  </span></span><br><span class="line">collection = client.get_or_create_collection(name=<span class="string">&quot;documents&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> dotenv  </span><br><span class="line">dotenv.load_dotenv()  </span><br><span class="line"><span class="comment"># —— 配置 —— #</span></span><br><span class="line">SILICONFLOW_API_KEY = os.getenv(<span class="string">&#x27;SILICONFLOW_API_KEY&#x27;</span>)  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">EMBEDDING_MODEL = <span class="string">&quot;BAAI/bge-large-zh-v1.5&quot;</span>  </span><br><span class="line">SILICONFLOW_EMBED_URL = <span class="string">&quot;https://api.siliconflow.cn/v1/embeddings&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 向量数据库目录  </span></span><br><span class="line">PERSIST_DIR = <span class="string">&quot;chroma_db&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 初始化 Chroma —— #</span></span><br><span class="line">client = PersistentClient(path=PERSIST_DIR)  </span><br><span class="line">collection = client.get_or_create_collection(name=<span class="string">&quot;documents&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 辅助函数：调用 SiliconFlow 获取 embedding —— #</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_embedding_siliconflow</span>(<span class="params">text: <span class="built_in">str</span>, model: <span class="built_in">str</span> = EMBEDDING_MODEL</span>):  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">    调用硅基流动 API 生成一个 embedding 向量。  </span></span><br><span class="line"><span class="string">    返回一个 list[float]。  </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    headers = &#123;  </span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;SILICONFLOW_API_KEY&#125;</span>&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    data = &#123;  </span><br><span class="line">        <span class="string">&quot;model&quot;</span>: model,  </span><br><span class="line">        <span class="string">&quot;input&quot;</span>: text  </span><br><span class="line">    &#125;  </span><br><span class="line">    resp = requests.post(SILICONFLOW_EMBED_URL, headers=headers, json=data)  </span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:  </span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Embedding 请求失败，状态码: <span class="subst">&#123;resp.status_code&#125;</span>, 内容: <span class="subst">&#123;resp.text&#125;</span>&quot;</span>)  </span><br><span class="line">    resp_json = resp.json()  </span><br><span class="line">    <span class="comment"># resp_json[&quot;data&quot;] 是一个列表，每项是 &#123;&quot;object&quot;:&quot;embedding&quot;, &quot;embedding&quot;:[...], &quot;index&quot;:...&#125;    </span></span><br><span class="line">    embedding_vec = resp_json[<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;embedding&quot;</span>]  </span><br><span class="line">    <span class="keyword">return</span> embedding_vec  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 准备文档 —— #</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_documents</span>(<span class="params">doc_paths</span>):  </span><br><span class="line">    docs = []  </span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> doc_paths:  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            text = f.read()  </span><br><span class="line">        source = os.path.basename(path)  </span><br><span class="line">        docs.append(&#123;<span class="string">&quot;id&quot;</span>: path, <span class="string">&quot;text&quot;</span>: text, <span class="string">&quot;source&quot;</span>: source&#125;)  </span><br><span class="line">    <span class="keyword">return</span> docs  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 插入文档到 Chroma —— #</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_documents</span>(<span class="params">documents, chunk_size=<span class="number">500</span>, overlap=<span class="number">50</span></span>):  </span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> documents:  </span><br><span class="line">        text = doc[<span class="string">&quot;text&quot;</span>]  </span><br><span class="line">        <span class="comment"># 简单分块方式  </span></span><br><span class="line">        chunks = []  </span><br><span class="line">        i = <span class="number">0</span>  </span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(text):  </span><br><span class="line">            chunk = text[i:i + chunk_size]  </span><br><span class="line">            chunks.append(chunk)  </span><br><span class="line">            i += chunk_size - overlap  <span class="comment"># 用重叠减少断句问题  </span></span><br><span class="line">        <span class="keyword">for</span> idx, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks):  </span><br><span class="line">            embedding_vec = get_embedding_siliconflow(chunk)  </span><br><span class="line">            collection.add(  </span><br><span class="line">                documents=[chunk],  </span><br><span class="line">                metadatas=[&#123;<span class="string">&quot;source&quot;</span>: doc[<span class="string">&quot;source&quot;</span>]&#125;],  </span><br><span class="line">                ids=[<span class="string">f&quot;<span class="subst">&#123;doc[<span class="string">&#x27;id&#x27;</span>]&#125;</span>_chunk_<span class="subst">&#123;idx&#125;</span>&quot;</span>],  </span><br><span class="line">                embeddings=[embedding_vec]  </span><br><span class="line">            )  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 查询与问答 —— #</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_and_answer</span>(<span class="params">question: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = <span class="number">3</span></span>):  </span><br><span class="line">    <span class="comment"># 1. 对问题做 embedding    </span></span><br><span class="line">    q_emb = get_embedding_siliconflow(question)  </span><br><span class="line">    <span class="comment"># 2. 用 Chroma 搜 nearest 文档块  </span></span><br><span class="line">    results = collection.query(  </span><br><span class="line">        query_embeddings=[q_emb],  </span><br><span class="line">        n_results=top_k  </span><br><span class="line">    )  </span><br><span class="line">    docs = results[<span class="string">&#x27;documents&#x27;</span>][<span class="number">0</span>]  <span class="comment"># top_k 文档块内容  </span></span><br><span class="line">    sources = [md[<span class="string">&quot;source&quot;</span>] <span class="keyword">for</span> md <span class="keyword">in</span> results[<span class="string">&#x27;metadatas&#x27;</span>][<span class="number">0</span>]]  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 3. 用这些作为 context 生成 prompt 给 LLM    # 这里示例用一个伪接口，你可以换成 OpenAI 或者也可以用硅基流动的 Chat Completion 接口（如果有的话）  </span></span><br><span class="line">    prompt = <span class="string">&quot;根据以下内容回答问题：\n\n&quot;</span>  </span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> docs:  </span><br><span class="line">        prompt += d + <span class="string">&quot;\n\n&quot;</span>  </span><br><span class="line">    prompt += <span class="string">f&quot;问题：<span class="subst">&#123;question&#125;</span>\n答案：&quot;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 4. 调用某个 LLM API 返回答案  </span></span><br><span class="line">    <span class="comment"># 举例假设我们用 OpenAI 的 ChatGPT API，这里只是示例  </span></span><br><span class="line">    <span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI  </span><br><span class="line">    client = OpenAI(  </span><br><span class="line">        api_key=os.getenv(<span class="string">&#x27;SILICONFLOW_API_KEY&#x27;</span>),  </span><br><span class="line">        base_url=os.getenv(<span class="string">&#x27;BASE_URL&#x27;</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    resp = client.chat.completions.create(  </span><br><span class="line">        model=<span class="string">&quot;deepseek-ai/DeepSeek-V3&quot;</span>,  </span><br><span class="line">        messages=[  </span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;你是一个知识问答助手&quot;</span>&#125;,  </span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;  </span><br><span class="line">        ],  </span><br><span class="line">        temperature=<span class="number">0</span>  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    answer = resp.choices[<span class="number">0</span>].message.content  </span><br><span class="line">    <span class="keyword">return</span> answer  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># —— 主流程 —— #if __name__ == &quot;__main__&quot;:  </span></span><br><span class="line">    <span class="comment"># 加载你的文本文件  </span></span><br><span class="line">    docs = load_documents([<span class="string">&quot;docs/biology.txt&quot;</span>, <span class="string">&quot;docs/computer.txt&quot;</span>, <span class="string">&quot;docs/history.txt&quot;</span>])  </span><br><span class="line">    <span class="comment"># 索引它们  </span></span><br><span class="line">    index_documents(docs)  </span><br><span class="line">    <span class="comment"># 测试查询  </span></span><br><span class="line">    question = <span class="string">&quot;请描述计算机是如何通过硬件与软件协同工作的。&quot;</span>  </span><br><span class="line">    answer = query_and_answer(question)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;问题：&quot;</span>, question)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;答案：&quot;</span>, answer)  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">问题： 请描述计算机是如何通过硬件与软件协同工作的。</span><br><span class="line">答案： 计算机通过硬件与软件协同工作，实现高效的数据处理和任务执行。具体协同过程如下：</span><br><span class="line"></span><br><span class="line">1. **硬件提供基础支持**  </span><br><span class="line">   - **CPU**作为核心运算部件，执行软件指令（如数学计算、逻辑判断）；  </span><br><span class="line">   - **内存**临时存储运行中的程序和数据，供CPU快速调用；  </span><br><span class="line">   - **存储设备**（如硬盘）长期保存系统软件、应用软件及用户文件；  </span><br><span class="line">   - 输入/输出设备（如键盘、显示器）实现人机交互。</span><br><span class="line"></span><br><span class="line">2. **软件驱动硬件功能**  </span><br><span class="line">   - **系统软件**（如Windows）直接管理硬件资源：  </span><br><span class="line">     - 分配CPU任务、调度内存空间、控制外设操作；  </span><br><span class="line">     - 为应用软件提供运行环境（如调用打印机驱动）。  </span><br><span class="line">   - **应用软件**（如Office）通过系统软件间接使用硬件：  </span><br><span class="line">     - 用户编辑文档时，软件将操作转化为CPU可执行的指令；  </span><br><span class="line">     - 数据经内存暂存后，由用户选择保存至硬盘。</span><br><span class="line"></span><br><span class="line">3. **协同示例**  </span><br><span class="line">   当运行视频会议软件（如钉钉）：  </span><br><span class="line">   - 软件调用CPU处理视频编码、内存缓存实时数据；  </span><br><span class="line">   - 系统软件协调摄像头（输入）和扬声器（输出）硬件；  </span><br><span class="line">   - 网络模块通过网卡硬件传输数据，完成远程协作。</span><br><span class="line"></span><br><span class="line">这种“硬件执行底层操作+软件调度资源与应用逻辑”的协作模式，使计算机能灵活适应从办公到人工智能的多样化需求。</span><br><span class="line"></span><br><span class="line">进程已结束，退出代码为 0</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://cryingatnight.github.io">Yinjin Yao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://cryingatnight.github.io/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/">https://cryingatnight.github.io/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://cryingatnight.github.io" target="_blank">Yinjin Yao的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/chroma/">chroma</a></div><div class="post-share"><div class="social-share" data-image="/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/26/LangChain%E4%BD%BF%E7%94%A8%E6%A6%82%E8%BF%B0/" title="LangChain使用概述"><img class="cover" src="/img/lita4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">LangChain使用概述</div></div><div class="info-2"><div class="info-item-1">LangChain使用概述LangChain的使用场景   项目名称 技术点 难度    文档问答助手 Prompt + Embedding + RetrievalQA ⭐⭐   智能日程规划助手 Agent + Tool + Memory ⭐⭐⭐   LLM+数据库问答 SQLDatabaseToolkit + Agent ⭐⭐⭐⭐   多模型路由对话系统 RouterChain + 多 LLM ⭐⭐⭐⭐   互联网智能客服 ConversationChain + RAG +Agent ⭐⭐⭐⭐⭐   企业知识库助手（RAG + 本地模 型） VectorDB + LLM + Streamlit ⭐⭐⭐⭐⭐   LangChain资料介绍 官网地址：https://www.langchain.com/langchain  官网文档：https://python.langchain.com/docs/introduction/  API文档：https://python.langchain.com/api_reference&#x2F;  github地址：https://git...</div></div></div></a><a class="pagination-related" href="/2025/09/19/%E9%80%90%E5%B1%82%E5%88%86%E8%A7%A3Transformer/" title="逐层分解Transformer"><img class="cover" src="/img/lita7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">逐层分解Transformer</div></div><div class="info-2"><div class="info-item-1">Transformer整体结构下面的Transformer的整体结构，下图是Transformer用与中英文翻译的整体结构：   [!notice]可以看到==Transformer==由==Encoder==和==Decoder==两个部分组成，Encoder和Decoder都包含6个==block==。   Transformer的工作流程大体如下: 第一步：获取输入句子的每一个单词的表示向量X,X由单词的 Embedding(Embedding就是从原始数据提取出来的Feature)和单词位置的 Embedding相加得到。  第二步：将得到的单词表示向量矩阵（如上图所示，每一行是一个单词的表示）传入 Encoder中，经过6个Encoder block(后可以得到句子所有单词的编码信息矩阵C,如下图。单词向量矩阵用表示，n是句子中单词个数，d是表示向量的维度( d=512)。每一个Encoder block输出的矩阵维度与输入完全一致。   第三步：将Encoder输出的编码信息矩阵C传递到Decoder中，Decoder依次会根据当前翻译过的单词1~i翻译下一个单词i+...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/headimage.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Yinjin Yao</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/cryingatnight/cryingatnight.github.io"><i class="fab fa-github"></i><span>关注</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/cryingatnight/cryingatnight.github.io" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1816192779@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9F%A2%E9%87%8F%E5%AD%98%E5%82%A8%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">什么是矢量存储？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFChromaDB%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">什么是ChromaDB？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ChromaDB%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">ChromaDB是如何工作的？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ChromaDB-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.</span> <span class="toc-text">ChromaDB 的核心概念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Chromadb"><span class="toc-number">2.1.</span> <span class="toc-text">安装Chromadb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96Chroma%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.2.</span> <span class="toc-text">初始化Chroma客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-%E8%8E%B7%E5%8F%96%E9%9B%86%E5%90%88-Collection"><span class="toc-number">2.3.</span> <span class="toc-text">创建&#x2F;获取集合 (Collection)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%91%E9%9B%86%E5%90%88%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE-Add-Upsert"><span class="toc-number">2.4.</span> <span class="toc-text">向集合添加数据 (Add&#x2F; Upsert)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%9B%86%E5%90%88-Query"><span class="toc-number">2.5.</span> <span class="toc-text">查询集合 (Query)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-number">2.6.</span> <span class="toc-text">管理数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8-%E9%87%8D%E8%A6%81%EF%BC%81"><span class="toc-number">2.7.</span> <span class="toc-text">持久化存储 (重要！)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.8.</span> <span class="toc-text">关键注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">完整流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">项目目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#biology-txt"><span class="toc-number">3.2.</span> <span class="toc-text">biology.txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#computer-txt"><span class="toc-number">3.3.</span> <span class="toc-text">computer.txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#history-txt"><span class="toc-number">3.4.</span> <span class="toc-text">history.txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#requirements-txt"><span class="toc-number">3.5.</span> <span class="toc-text">requirements.txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#env"><span class="toc-number">3.6.</span> <span class="toc-text">.env</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-py%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.</span> <span class="toc-text">main.py文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">3.8.</span> <span class="toc-text">运行结果</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/28/LangChain%E4%BD%BF%E7%94%A8%E4%B9%8BRetrieval/" title="LangChain使用之Retrieval"><img src="/img/lita9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LangChain使用之Retrieval"/></a><div class="content"><a class="title" href="/2025/09/28/LangChain%E4%BD%BF%E7%94%A8%E4%B9%8BRetrieval/" title="LangChain使用之Retrieval">LangChain使用之Retrieval</a><time datetime="2025-09-28T03:10:40.030Z" title="更新于 2025-09-28 11:10:40">2025-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/26/LangChain%E4%BD%BF%E7%94%A8%E6%A6%82%E8%BF%B0/" title="LangChain使用概述"><img src="/img/lita4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LangChain使用概述"/></a><div class="content"><a class="title" href="/2025/09/26/LangChain%E4%BD%BF%E7%94%A8%E6%A6%82%E8%BF%B0/" title="LangChain使用概述">LangChain使用概述</a><time datetime="2025-09-26T03:37:36.148Z" title="更新于 2025-09-26 11:37:36">2025-09-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" title="chromadb向量数据库"><img src="/img/%E4%BA%94%E6%9D%A1%E6%82%9F.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="chromadb向量数据库"/></a><div class="content"><a class="title" href="/2025/09/23/chromadb%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" title="chromadb向量数据库">chromadb向量数据库</a><time datetime="2025-09-23T16:37:51.853Z" title="更新于 2025-09-24 00:37:51">2025-09-24</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Yinjin Yao</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div><div class="footer_custom_text">感谢阅读</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="输入以搜索内容..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>